# LucyAgent：LLM-based agent设计实践

记得加emoji和总览图，尽量用gpt减轻工作量

## 主要特性
- Perception,Brain,Action框架
- 记忆流
- 知识库
- 工具库（如wiki检索）
- LLM决策的有限状态机
- Gradio可视化
- 充分的prompt设计
- 不依赖langchain

## brain模块

### 记忆模块设计

#### 记忆单元
- 记忆单元由其记忆描述，创建时间，描述的嵌入构成。
- 记忆流是记忆单元的简单列表。

```python
memory = {
    "description": "记忆描述",
    "create_time": "创建时间",
    "embedding": "嵌入向量",
}
```

#### 记忆系统设计
- 创建记忆 (`create_memory`)：根据输入和输出创建一个记忆摘要。这个摘要包含了事件的描述，创建时间，以及通过外部API生成的嵌入向量
- 添加记忆 (`add_memory`)：将记忆被添加到记忆流中。当记忆流达到设定的上限时，会自动触发总结记忆的过程。
- 总结记忆 (`summarize_memory`)：在总结记忆中，最相似的几个记忆会被总结并形成一个新的记忆，然后被添加到记忆流中。
- 删除记忆 (`del_memory`)：按索引删除记忆或者清空所有记忆，也支持删除与某个查询最相似的记忆。
- 展示记忆 (`show_memory`)：展示记忆功能会列出所有记忆摘要、创建时间和嵌入向量的大小。
- 搜索记忆 (`search_memory`)：通过计算查询文本的嵌入与记忆流中每个记忆的嵌入之间的相似度，搜索功能可以找到最匹配的记忆。

#### 知识单元
- 知识单元由其知识文本和文本的嵌入构成。
- 知识库是知识单元的集合，可以是简单列表或者更复杂的数据结构，如搜索树，以便于高效检索。

```python
knowledge = {
    "text": "知识文本",
    "embedding": "嵌入向量",
}
```

#### 知识系统设计
- 提取知识 (`extract_knowledge`)：从给定的文本中提取知识点，并生成嵌入向量。这通常涉及对文本的理解和总结。
- 添加知识 (`add_knowledge`)：将提取的知识和对应的嵌入向量添加到知识库中。
- 删除知识 (`del_knowledge`)：按索引删除知识或者清空所有知识。
- 展示知识 (`show_knowledge`)：展示知识功能会列出所有知识文本和嵌入向量的大小。
- 搜索知识 (`search_knowledge`)：通过计算查询文本的嵌入与知识库中每个知识的嵌入之间的相似度，搜索功能可以找到最匹配的知识。

### 角色配置说明

- `name`: 字符串类型，表示角色的姓名。

- `seed_memory`: 字符串类型，提供了角色的背景故事，包括角色的身份、职责以及个人兴趣等信息。

- `language_style`: 字符串类型，展示了角色独特的语言表达方式和个性。

- `current_state`: 字符串类型，指示角色目前的活动或状态。

- `basic_knowledge`: 数组类型，用于存储有关角色的基础知识，初始为一个空数组。

- `memory_stream`: 数组类型，旨在捕捉角色记忆流的数据，初始为一个空数组。

- `mood_list`: 数组类型，指的是fsm的可能状态。

- `emoji_list`: 数组类型，指的是fsm中的状态对应的资源列表，在本例中简单地用对应表情包指示。

### JSON映射到NPC的属性
```json
{
  "name": "角色名称",
  "seed_memory": "角色背景故事描述",
  "language_style": "角色语言风格描述",
  "current_state": "角色当前状态描述",
  "basic_knowledge": [],
  "memory_stream": [],
  "mood_list": [],
  "emoji_list": []
}
```